<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskTracker Pro</title>
    
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load React & ReactDOM (Universal Build - More Stable) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { overscroll-behavior-y: none; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 4. Application Logic -->
    <script type="text/babel">
        // Access React Globals
        const { useState, useEffect } = React;
        const root = ReactDOM.createRoot(document.getElementById('root'));

        // --- ICONS (Manually defined to prevent import errors) ---
        const IconBase = ({ d, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {d}
            </svg>
        );

        const Check = (p) => <IconBase {...p} d={<polyline points="20 6 9 17 4 12" />} />;
        const Plus = (p) => <IconBase {...p} d={<><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>} />;
        const Trash2 = (p) => <IconBase {...p} d={<><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></>} />;
        const Sun = (p) => <IconBase {...p} d={<><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></>} />;
        const Moon = (p) => <IconBase {...p} d={<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>} />;
        const Smartphone = (p) => <IconBase {...p} d={<><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></>} />;
        const Menu = (p) => <IconBase {...p} d={<><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></>} />;

        // --- UTILS ---
        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);
        const formatDate = (date) => new Intl.DateTimeFormat('en-US', { weekday: 'short', month: 'short', day: 'numeric' }).format(date);

        // --- THEME ---
        const THEME = {
            light: {
                bg: '#e0e5ec',
                text: 'text-gray-700',
                textSecondary: 'text-gray-500',
                shadowOuter: '9px 9px 16px rgba(163,177,198,0.6), -9px -9px 16px rgba(255,255,255,0.5)',
                shadowInner: 'inset 6px 6px 10px #a3b1c6, inset -6px -6px 10px #ffffff',
                shadowButton: '6px 6px 10px #a3b1c6, -6px -6px 10px #ffffff',
                accent: 'text-purple-600',
            },
            dark: {
                bg: '#212121',
                text: 'text-gray-200',
                textSecondary: 'text-gray-400',
                shadowOuter: '9px 9px 16px #151515, -9px -9px 16px #2d2d2d',
                shadowInner: 'inset 6px 6px 10px #151515, inset -6px -6px 10px #2d2d2d',
                shadowButton: '6px 6px 10px #151515, -6px -6px 10px #2d2d2d',
                accent: 'text-purple-400',
            }
        };

        const getPriorityColor = (priority, isDark) => {
            if (isDark) {
                switch(priority) {
                    case 'high': return 'text-red-400 font-bold';
                    case 'medium': return 'text-orange-400 font-bold';
                    case 'low': return 'text-blue-400 font-bold';
                    default: return 'text-gray-400';
                }
            }
            switch(priority) {
                case 'high': return 'text-red-500 font-bold';
                case 'medium': return 'text-orange-500 font-bold';
                case 'low': return 'text-blue-500 font-bold';
                default: return 'text-gray-500';
            }
        };

        // --- COMPONENTS ---
        const NeuCard = ({ children, className = "", isDark }) => {
            const t = isDark ? THEME.dark : THEME.light;
            return (
                <div style={{ backgroundColor: t.bg, boxShadow: t.shadowOuter }} className={`rounded-3xl transition-colors duration-300 ${className}`}>
                    {children}
                </div>
            );
        };

        const NeuButton = ({ children, onClick, active, className = "", isDark, ...props }) => {
            const t = isDark ? THEME.dark : THEME.light;
            return (
                <button 
                    onClick={onClick}
                    style={{ backgroundColor: t.bg, boxShadow: active ? t.shadowInner : t.shadowButton }}
                    className={`rounded-xl font-medium transition-all duration-200 ease-in-out px-4 py-3 hover:translate-y-[-2px] active:translate-y-[0px] ${active ? t.accent : t.textSecondary} ${className}`}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        const NeuInput = ({ isDark, ...props }) => {
            const t = isDark ? THEME.dark : THEME.light;
            return (
                <input 
                    {...props}
                    style={{ backgroundColor: t.bg, boxShadow: t.shadowInner }}
                    className={`w-full rounded-xl px-4 py-3 outline-none transition-colors duration-300 ${t.text} placeholder-gray-500`}
                />
            );
        };

        const NeuIconButton = ({ children, onClick, className = "", title, isDark, ...props }) => {
            const t = isDark ? THEME.dark : THEME.light;
            return (
                <button 
                    onClick={onClick}
                    title={title}
                    style={{ backgroundColor: t.bg, boxShadow: t.shadowButton }}
                    className={`w-10 h-10 flex items-center justify-center rounded-full transition-all duration-200 hover:text-purple-500 active:scale-95 ${t.textSecondary} ${className}`}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        const AddTaskModal = ({ isOpen, onClose, onAdd, isDark }) => {
            const [title, setTitle] = useState("");
            const [type, setType] = useState("daily");
            const [priority, setPriority] = useState("medium");
            const t = isDark ? THEME.dark : THEME.light;

            if (!isOpen) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!title.trim()) return;
                onAdd({ title, type, priority });
                setTitle("");
                onClose();
            };

            return (
                <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200 ${isDark ? 'bg-black/60' : 'bg-white/60'}`}>
                    <NeuCard isDark={isDark} className="w-full max-w-md p-8 border border-white/5">
                        <h2 className={`text-2xl font-bold mb-6 flex items-center gap-2 ${t.text}`}>  
                            <Plus className="w-6 h-6 text-purple-500" /> New Task
                        </h2>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className={`block text-sm font-semibold mb-2 ml-1 ${t.textSecondary}`}>What needs doing?</label>
                                <NeuInput isDark={isDark} value={title} onChange={(e) => setTitle(e.target.value)} placeholder="e.g., Call Client" autoFocus />
                            </div>
                            
                            <div className="grid grid-cols-2 gap-6">
                                <div>
                                    <label className={`block text-sm font-semibold mb-2 ml-1 ${t.textSecondary}`}>Type</label>
                                    <div className="flex gap-3">
                                        <NeuButton type="button" isDark={isDark} onClick={() => setType("daily")} active={type === 'daily'} className="flex-1 text-sm">Daily</NeuButton>
                                        <NeuButton type="button" isDark={isDark} onClick={() => setType("monthly")} active={type === 'monthly'} className="flex-1 text-sm">Month</NeuButton>
                                    </div>
                                </div>
                                <div>
                                    <label className={`block text-sm font-semibold mb-2 ml-1 ${t.textSecondary}`}>Priority</label>
                                    <div className="relative">
                                        <select 
                                            value={priority} onChange={(e) => setPriority(e.target.value)}
                                            style={{ backgroundColor: t.bg, boxShadow: t.shadowInner }}
                                            className={`w-full rounded-xl px-3 py-3 outline-none appearance-none cursor-pointer ${t.text}`}
                                        >
                                            <option value="high">High</option>
                                            <option value="medium">Medium</option>
                                            <option value="low">Low</option>
                                        </select>
                                        <div className="absolute right-3 top-3.5 pointer-events-none text-gray-500">
                                            <Menu className="w-4 h-4" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-4 pt-4">
                                <NeuButton type="button" isDark={isDark} onClick={onClose} className="flex-1">Cancel</NeuButton>
                                <NeuButton type="submit" isDark={isDark} className="flex-1 !text-purple-600 font-bold">Add Task</NeuButton>
                            </div>
                        </form>
                    </NeuCard>
                </div>
            );
        };

        const TaskItem = ({ task, onToggle, onDelete, isDark }) => {
            const t = isDark ? THEME.dark : THEME.light;
            return (
                <div style={{ backgroundColor: t.bg, boxShadow: t.shadowOuter }} className={`group flex items-center gap-4 p-4 mb-4 rounded-2xl transition-all duration-300 hover:translate-y-[-2px]`}>
                    <button 
                        onClick={() => onToggle(task.id)}
                        style={{ backgroundColor: t.bg, boxShadow: task.completed ? t.shadowInner : t.shadowButton }}
                        className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 ${task.completed ? 'text-green-500' : 'text-gray-300 hover:text-purple-400'}`}
                    >
                        <Check className="w-5 h-5" />
                    </button>
                    
                    <div className="flex-1 min-w-0">
                        <h3 className={`font-semibold text-lg break-words transition-all ${task.completed ? 'text-gray-500 line-through' : t.text}`}>  
                            {task.title}
                        </h3>
                        <div className="flex items-center gap-2 mt-1">
                            <span className={`text-[11px] uppercase tracking-wider ${getPriorityColor(task.priority, isDark)}`}>  
                                {task.priority}
                            </span>
                            {task.type === 'monthly' && <span className="text-[10px] text-gray-400 font-medium">â€¢ Monthly</span>}
                        </div>
                    </div>

                    <NeuIconButton isDark={isDark} onClick={() => onDelete(task.id)} className="!w-10 !h-10 text-red-400 hover:text-red-500 hover:!text-red-500">
                        <Trash2 className="w-5 h-5" />
                    </NeuIconButton>
                </div>
            );
        };

        function App() {
            const [tasks, setTasks] = useState(() => {
                try {
                    const saved = localStorage.getItem('neu-tasks-v2');
                    return saved ? JSON.parse(saved) : [{ id: '1', title: 'Welcome to TaskTracker', type: 'daily', priority: 'medium', completed: false }];
                } catch (e) { return []; }
            });
            
            const [isDark, setIsDark] = useState(() => {
                try {
                    const saved = localStorage.getItem('neu-theme-pref');
                    return saved !== null ? JSON.parse(saved) : false;
                } catch (e) { return false; }
            });

            const [isModalOpen, setIsModalOpen] = useState(false);
            const [view, setView] = useState('daily');
            const [today] = useState(new Date());

            useEffect(() => { localStorage.setItem('neu-tasks-v2', JSON.stringify(tasks)); }, [tasks]);
            useEffect(() => { 
                localStorage.setItem('neu-theme-pref', JSON.stringify(isDark));
                document.body.style.backgroundColor = isDark ? THEME.dark.bg : THEME.light.bg;
            }, [isDark]);

            const addTask = (newTask) => setTasks(prev => [...prev, { ...newTask, id: generateId(), completed: false, createdAt: new Date().toISOString() }]);
            const toggleTask = (id) => setTasks(prev => prev.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
            const deleteTask = (id) => setTasks(prev => prev.filter(t => t.id !== id));

            const filteredTasks = tasks
                .filter(t => t.type === view)
                .sort((a, b) => {
                    if (a.completed !== b.completed) return a.completed ? 1 : -1;
                    const priorities = { high: 0, medium: 1, low: 2 };
                    return priorities[a.priority] - priorities[b.priority];
                });

            const progress = Math.round((tasks.filter(t => t.type === view && t.completed).length / (tasks.filter(t => t.type === view).length || 1)) * 100);
            const t = isDark ? THEME.dark : THEME.light;

            return (
                <div className={`min-h-screen font-sans selection:bg-purple-200 transition-colors duration-300 ${isDark ? 'text-gray-200' : 'text-gray-700'}`}>  
                    <div className="max-w-xl mx-auto p-4 sm:p-6 flex flex-col min-h-screen">
                        
                        <header className="mb-8 sm:mb-10 pt-4 flex items-center justify-between">
                            <div>
                                <h1 className={`text-3xl sm:text-4xl font-black tracking-tight ${t.text}`}>Task<span className="text-purple-600">Tracker</span></h1>
                                <p className={`${t.textSecondary} font-medium mt-1 ml-1`}>{formatDate(today)}</p>
                            </div>
                            <NeuIconButton isDark={isDark} onClick={() => setIsDark(!isDark)} className="!w-12 !h-12 sm:!w-14 sm:!h-14">
                                {isDark ? <Sun className="w-5 h-5 sm:w-6 sm:h-6 text-yellow-500" /> : <Moon className="w-5 h-5 sm:w-6 sm:h-6 text-purple-600" />}
                            </NeuIconButton>
                        </header>

                        <div style={{ backgroundColor: t.bg, boxShadow: t.shadowInner }} className="p-2 rounded-2xl flex mb-8 sm:mb-10 transition-shadow duration-300">
                            <button onClick={() => setView('daily')} style={view === 'daily' ? { boxShadow: t.shadowOuter } : {}} className={`flex-1 py-3 rounded-xl font-bold text-sm transition-all duration-300 flex items-center justify-center gap-2 ${view === 'daily' ? `${t.bg} ${isDark ? 'text-purple-400' : 'text-purple-600'}` : 'text-gray-400'}`}>
                                <Sun className="w-4 h-4" /> Daily Focus
                            </button>
                            <button onClick={() => setView('monthly')} style={view === 'monthly' ? { boxShadow: t.shadowOuter } : {}} className={`flex-1 py-3 rounded-xl font-bold text-sm transition-all duration-300 flex items-center justify-center gap-2 ${view === 'monthly' ? `${t.bg} ${isDark ? 'text-blue-400' : 'text-blue-600'}` : 'text-gray-400'}`}>
                                <Moon className="w-4 h-4" /> Monthly
                            </button>
                        </div>
                        
                        <div className="mb-8">
                            <div className={`flex justify-between text-sm font-bold mb-2 ml-1 ${t.textSecondary}`}> 
                                <span>Progress</span>
                                <span>{progress}%</span>
                            </div>
                            <div style={{ backgroundColor: t.bg, boxShadow: t.shadowInner }} className="w-full rounded-full h-4 p-1">
                                <div className="h-full rounded-full bg-purple-500 transition-all duration-1000 ease-out" style={{ width: `${progress}%`, boxShadow: '2px 2px 4px rgba(0,0,0,0.2)' }} />
                            </div>
                        </div>

                        <div className="flex-1 space-y-2 pb-24">
                            {filteredTasks.length > 0 ? (
                                filteredTasks.map(task => <TaskItem key={task.id} task={task} onToggle={toggleTask} onDelete={deleteTask} isDark={isDark} />)
                            ) : (
                                <div className="text-center py-16">
                                    <div style={{ backgroundColor: t.bg, boxShadow: t.shadowInner }} className="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 opacity-50">
                                        <Smartphone className="w-8 h-8" />
                                    </div>
                                    <p className={`${t.textSecondary} font-medium`}>All clear for {view === 'daily' ? 'today' : 'this month'}.</p>
                                </div>
                            )}
                        </div>

                        <button onClick={() => setIsModalOpen(true)} style={{ backgroundColor: t.bg, boxShadow: t.shadowOuter }} className="fixed bottom-8 right-8 w-16 h-16 rounded-full text-purple-600 flex items-center justify-center hover:scale-110 active:scale-95 transition-all duration-300 z-40">
                            <Plus className="w-8 h-8" strokeWidth={3} />
                        </button>

                        <AddTaskModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} onAdd={addTask} isDark={isDark} />
                    </div>
                </div>
            );
        }

        root.render(<App />);
    </script>
</body>
</html>